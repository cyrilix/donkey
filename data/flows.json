[{"id":"1c4a0adf.6f1c6d","type":"tab","label":"Mqtt","disabled":false,"info":""},{"id":"318e3463.53696c","type":"tab","label":"Video","disabled":false,"info":""},{"id":"e4efdb3b.bee6e","type":"mqtt-broker","z":"","name":"diabolo","broker":"192.168.1.204","port":"1883","clientid":"nodered","usetls":false,"compatmode":true,"keepalive":"60","cleansession":false,"willTopic":"","willQos":"0","willPayload":"","birthTopic":"","birthQos":"0","birthPayload":""},{"id":"5a7b8465.37fcbc","type":"ui_tab","z":"1c4a0adf.6f1c6d","name":"Home","icon":"home","order":1},{"id":"136a4024.3f49f","type":"ui_group","z":"1c4a0adf.6f1c6d","name":"Metrics","tab":"5a7b8465.37fcbc","order":2,"disp":true,"width":"6","collapse":false},{"id":"e986a62c.1e0a88","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}}},"site":{"name":"Fous du volant board","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"c8f53699.bbd128","type":"ui_group","z":"","name":"Vision","tab":"5a7b8465.37fcbc","order":1,"disp":true,"width":"18","collapse":false},{"id":"f0a34f2f.71734","type":"mqtt-broker","z":"","name":"local","broker":"mqtt","port":"1883","clientid":"nodered-","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willPayload":"","birthTopic":"","birthQos":"0","birthPayload":""},{"id":"5cbd4649.35c31","type":"mqtt-broker","z":"","name":"satanas","broker":"satanas.local","port":"1883","clientid":"nodered-","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willPayload":"","birthTopic":"","birthQos":"0","birthPayload":""},{"id":"577102d8.1f508c","type":"ui_group","z":"","name":"Threshold","tab":"5a7b8465.37fcbc","order":3,"disp":true,"width":"12","collapse":false},{"id":"36a57def.9cc8ea","type":"ui_group","z":"","name":"Commands","tab":"5a7b8465.37fcbc","order":4,"disp":true,"width":"6","collapse":false},{"id":"f24d64c6.6d0b7","type":"mqtt in","z":"1c4a0adf.6f1c6d","name":"","topic":"fousduvolant/+/parts","qos":"1","broker":"f0a34f2f.71734","x":130,"y":320,"wires":[["3a663e19.3a6d1a"]]},{"id":"3a663e19.3a6d1a","type":"json","z":"1c4a0adf.6f1c6d","name":"","property":"payload","action":"","pretty":false,"x":310,"y":320,"wires":[["24aff43f.f36d9c"]]},{"id":"24aff43f.f36d9c","type":"function","z":"1c4a0adf.6f1c6d","name":"extract data","func":"var parts = msg.payload.payload;\nmsg.payload = parts;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":320,"wires":[["6092201.7da46e","6b1249fe.e4dcb","5b906e2e.cdab1","175087d7.f5b628","36176800.4dc03","a7cc7913.e0a668"]]},{"id":"177d96f7.09c639","type":"ui_gauge","z":"1c4a0adf.6f1c6d","name":"","group":"136a4024.3f49f","order":0,"width":0,"height":0,"gtype":"gage","title":"Throttle","label":"units","format":"{{ value | number:2 }}","min":"0","max":"1","colors":["#00b500","#e6e600","#ca3838"],"seg1":"0,4","seg2":"0,8","x":1320,"y":460,"wires":[]},{"id":"28ad500c.2db76","type":"mqtt out","z":"1c4a0adf.6f1c6d","name":"local","topic":"","qos":"1","retain":"true","broker":"f0a34f2f.71734","x":250,"y":160,"wires":[]},{"id":"e010a1c.f2ce86","type":"mqtt in","z":"1c4a0adf.6f1c6d","name":"","topic":"#","qos":"0","broker":"e4efdb3b.bee6e","x":90,"y":160,"wires":[["28ad500c.2db76","8269327.c1290d"]]},{"id":"d6560013.65a8c8","type":"comment","z":"1c4a0adf.6f1c6d","name":"Fetch message to local server","info":"","x":170,"y":60,"wires":[]},{"id":"8269327.c1290d","type":"debug","z":"1c4a0adf.6f1c6d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":290,"y":100,"wires":[]},{"id":"95dbd87.e3a4c28","type":"http in","z":"318e3463.53696c","name":"","url":"/video_camera","method":"get","upload":false,"swaggerDoc":"","x":630,"y":140,"wires":[["eed54432.c06578"]]},{"id":"2a4ccdd3.c8adb2","type":"comment","z":"318e3463.53696c","name":"camera","info":"","x":70,"y":140,"wires":[]},{"id":"eed54432.c06578","type":"multipart-encoder","z":"318e3463.53696c","name":"","statusCode":"","ignoreMessages":true,"outputOneNew":false,"outputIfSingle":true,"outputIfAll":true,"globalHeaders":{"Content-Type":"multipart/x-mixed-replace;boundary=--myboundary","Connection":"keep-alive","Expires":"Fri, 01 Jan 1990 00:00:00 GMT","Cache-Control":"no-cache, no-store, max-age=0, must-revalidate","Pragma":"no-cache"},"partHeaders":{"Content-Type":"image/jpeg"},"destination":"all","highWaterMark":16384,"x":1020,"y":140,"wires":[["673c0a28.a8dcfc"]]},{"id":"6e401af1.ad1a44","type":"function","z":"318e3463.53696c","name":"format msg","func":"var newMsg = {};\nnewMsg.payload = Buffer.from(msg.payload, 'base64')\nreturn newMsg;","outputs":1,"noerr":0,"x":830,"y":200,"wires":[["eed54432.c06578"]]},{"id":"41a77af8.dcbf44","type":"http in","z":"318e3463.53696c","name":"","url":"/video_contours","method":"get","upload":false,"swaggerDoc":"","x":640,"y":300,"wires":[["b71b5c62.a01e68"]]},{"id":"23c2e31c.b05e6c","type":"comment","z":"318e3463.53696c","name":"contours","info":"","x":80,"y":300,"wires":[]},{"id":"673c0a28.a8dcfc","type":"debug","z":"318e3463.53696c","name":"Encoder output","active":false,"console":"false","complete":"res","x":1220,"y":300,"wires":[]},{"id":"b71b5c62.a01e68","type":"multipart-encoder","z":"318e3463.53696c","name":"","statusCode":"","ignoreMessages":true,"outputOneNew":false,"outputIfSingle":true,"outputIfAll":true,"globalHeaders":{"Content-Type":"multipart/x-mixed-replace;boundary=--myboundary","Connection":"keep-alive","Expires":"Fri, 01 Jan 1990 00:00:00 GMT","Cache-Control":"no-cache, no-store, max-age=0, must-revalidate","Pragma":"no-cache"},"partHeaders":{"Content-Type":"image/jpeg"},"destination":"all","highWaterMark":16384,"x":1020,"y":300,"wires":[["673c0a28.a8dcfc"]]},{"id":"c223a078.dae848","type":"function","z":"318e3463.53696c","name":"format msg","func":"var newMsg = {};\nnewMsg.payload = Buffer.from(msg.payload, 'base64')\nreturn newMsg;","outputs":1,"noerr":0,"x":830,"y":360,"wires":[["b71b5c62.a01e68"]]},{"id":"a5504881.c442d8","type":"comment","z":"318e3463.53696c","name":"Stream to all clients","info":"","x":150,"y":40,"wires":[]},{"id":"6092201.7da46e","type":"function","z":"1c4a0adf.6f1c6d","name":"pilot/throttle","func":"msg.payload = msg.payload['pilot/throttle'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":460,"wires":[["b9843f1e.e75b28"]]},{"id":"41d5f97e.dd6b5","type":"ui_gauge","z":"1c4a0adf.6f1c6d","name":"","group":"136a4024.3f49f","order":0,"width":0,"height":0,"gtype":"gage","title":"Steering","label":"units","format":"{{ value | number:2 }}","min":"-1","max":"1","colors":["#00b500","#00b500","#00b500"],"seg1":"","seg2":"","x":1320,"y":520,"wires":[]},{"id":"6b1249fe.e4dcb","type":"function","z":"1c4a0adf.6f1c6d","name":"pilot/angle","func":"msg.payload = msg.payload['pilot/angle'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":520,"wires":[["3b3cd114.6b2dce"]]},{"id":"5b906e2e.cdab1","type":"function","z":"1c4a0adf.6f1c6d","name":"cfg/threshold/from_line","func":"msg.payload = msg.payload['cfg/threshold/from_line'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":280,"wires":[["88c3cc6.b34d73"]]},{"id":"a5f9804e.70b25","type":"http in","z":"318e3463.53696c","name":"","url":"/video_processed","method":"get","upload":false,"swaggerDoc":"","x":640,"y":440,"wires":[["97071807.0acc3"]]},{"id":"158c8a24.90f366","type":"comment","z":"318e3463.53696c","name":"contours","info":"","x":80,"y":440,"wires":[]},{"id":"97071807.0acc3","type":"multipart-encoder","z":"318e3463.53696c","name":"","statusCode":"","ignoreMessages":true,"outputOneNew":false,"outputIfSingle":true,"outputIfAll":true,"globalHeaders":{"Content-Type":"multipart/x-mixed-replace;boundary=--myboundary","Connection":"keep-alive","Expires":"Fri, 01 Jan 1990 00:00:00 GMT","Cache-Control":"no-cache, no-store, max-age=0, must-revalidate","Pragma":"no-cache"},"partHeaders":{"Content-Type":"image/jpeg"},"destination":"all","highWaterMark":16384,"x":1020,"y":440,"wires":[["673c0a28.a8dcfc"]]},{"id":"a46213d.034ba7","type":"function","z":"318e3463.53696c","name":"format msg","func":"var newMsg = {};\nnewMsg.payload = Buffer.from(msg.payload, 'base64')\nreturn newMsg;","outputs":1,"noerr":0,"x":830,"y":500,"wires":[["97071807.0acc3"]]},{"id":"175087d7.f5b628","type":"function","z":"1c4a0adf.6f1c6d","name":"cfg/threshold/dynamic/delta","func":"msg.payload = msg.payload['cfg/threshold/dynamic/delta'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":220,"wires":[["7343e284.711654"]]},{"id":"e8677cf7.b60778","type":"ui_slider","z":"1c4a0adf.6f1c6d","name":"Threshold min","label":"Threshold min ({{ value }})","group":"577102d8.1f508c","order":4,"width":0,"height":0,"passthru":true,"topic":"","min":0,"max":"255","step":"1","x":1340,"y":340,"wires":[["220ade66.edbc3a"]]},{"id":"36176800.4dc03","type":"function","z":"1c4a0adf.6f1c6d","name":"cfg/threshold/limit/min","func":"msg.payload = msg.payload['cfg/threshold/limit/min'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":340,"wires":[["a5c2b392.308f5"]]},{"id":"b64f6abf.6d8918","type":"ui_slider","z":"1c4a0adf.6f1c6d","name":"Threshold max","label":"Threshold max ({{ value }})","group":"577102d8.1f508c","order":5,"width":0,"height":0,"passthru":true,"topic":"","min":0,"max":"255","step":1,"x":1340,"y":400,"wires":[["6db72af5.b09034"]]},{"id":"a7cc7913.e0a668","type":"function","z":"1c4a0adf.6f1c6d","name":"cfg/threshold/limit/max","func":"msg.payload = msg.payload['cfg/threshold/limit/max'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":400,"wires":[["2f0473c1.b0ae9c"]]},{"id":"a5c2b392.308f5","type":"rbe","z":"1c4a0adf.6f1c6d","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1050,"y":340,"wires":[["e8677cf7.b60778"]]},{"id":"2f0473c1.b0ae9c","type":"rbe","z":"1c4a0adf.6f1c6d","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1050,"y":400,"wires":[["b64f6abf.6d8918"]]},{"id":"220ade66.edbc3a","type":"mqtt out","z":"1c4a0adf.6f1c6d","name":"","topic":"config/threshold/min","qos":"0","retain":"","broker":"e4efdb3b.bee6e","x":1600,"y":340,"wires":[]},{"id":"6db72af5.b09034","type":"mqtt out","z":"1c4a0adf.6f1c6d","name":"","topic":"config/threshold/max","qos":"0","retain":"","broker":"e4efdb3b.bee6e","x":1600,"y":400,"wires":[]},{"id":"4dc1192.55c1e68","type":"ui_switch","z":"1c4a0adf.6f1c6d","name":"","label":"Dynamic Threshold","group":"577102d8.1f508c","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":830,"y":80,"wires":[["cfcb53ae.313168","26bc10d7.eb045"]]},{"id":"2a5fdd74.f93502","type":"ui_button","z":"1c4a0adf.6f1c6d","name":"","group":"136a4024.3f49f","order":0,"width":"6","height":"2","passthru":false,"label":"Autopilot","color":"","bgcolor":"green","icon":"","payload":"","payloadType":"str","topic":"","x":1100,"y":600,"wires":[["edd580f3.e19eb"]]},{"id":"b7834c20.bd1918","type":"json","z":"318e3463.53696c","name":"","property":"payload","action":"","pretty":false,"x":430,"y":200,"wires":[["35260bb9.3206f4"]]},{"id":"35260bb9.3206f4","type":"function","z":"318e3463.53696c","name":"extract image","func":"var image = msg.payload.payload;\nmsg.payload = image;\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":200,"wires":[["6e401af1.ad1a44"]]},{"id":"8e805af6.2f9968","type":"mqtt in","z":"318e3463.53696c","name":"","topic":"fousduvolant/+/image/cam/image_array","qos":"1","broker":"f0a34f2f.71734","x":180,"y":200,"wires":[["b7834c20.bd1918"]]},{"id":"312f2021.3b569","type":"ui_template","z":"318e3463.53696c","group":"c8f53699.bbd128","name":"Image camera","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_camera\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":240,"y":140,"wires":[[]]},{"id":"29f8a202.23620e","type":"ui_template","z":"318e3463.53696c","group":"c8f53699.bbd128","name":"Image processed","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_processed\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":250,"y":440,"wires":[[]]},{"id":"1637f06a.3517d8","type":"mqtt in","z":"318e3463.53696c","name":"","topic":"fousduvolant/+/image/img/processed","qos":"1","broker":"f0a34f2f.71734","x":170,"y":500,"wires":[["ec2c02ba.fb5a8"]]},{"id":"ec2c02ba.fb5a8","type":"json","z":"318e3463.53696c","name":"","property":"payload","action":"","pretty":false,"x":430,"y":500,"wires":[["89711665.93862"]]},{"id":"89711665.93862","type":"function","z":"318e3463.53696c","name":"extract image","func":"var image = msg.payload.payload;\nmsg.payload = image;\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":500,"wires":[["a46213d.034ba7"]]},{"id":"1cdc2bf2.d276dc","type":"ui_template","z":"318e3463.53696c","group":"c8f53699.bbd128","name":"Image contours","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_contours\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":240,"y":300,"wires":[[]]},{"id":"d0b27a81.1dfe9","type":"mqtt in","z":"318e3463.53696c","name":"","topic":"fousduvolant/+/image/img/contours","qos":"1","broker":"f0a34f2f.71734","x":160,"y":360,"wires":[["9a2fa2e9.7af458"]]},{"id":"9a2fa2e9.7af458","type":"json","z":"318e3463.53696c","name":"","property":"payload","action":"","pretty":false,"x":430,"y":360,"wires":[["b9c7190.a7b1ee8"]]},{"id":"b9c7190.a7b1ee8","type":"function","z":"318e3463.53696c","name":"extract image","func":"var image = msg.payload.payload;\nmsg.payload = image;\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":360,"wires":[["c223a078.dae848"]]},{"id":"b9843f1e.e75b28","type":"rbe","z":"1c4a0adf.6f1c6d","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1050,"y":460,"wires":[["177d96f7.09c639"]]},{"id":"3b3cd114.6b2dce","type":"rbe","z":"1c4a0adf.6f1c6d","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1050,"y":520,"wires":[["41d5f97e.dd6b5"]]},{"id":"cfcb53ae.313168","type":"function","z":"1c4a0adf.6f1c6d","name":"enable when On","func":"var msg_enable = {};\nmsg_enable.topic= msg.topic;\nvar msg_disable = {};\nmsg_disable.topic= msg.topic;\n\nif (msg.payload) {\n    msg_enable.enabled = true;\n    msg_disable.enabled = false;\n}else {\n    msg_enable.enabled = false;\n    msg_disable.enabled = true;\n}\n\nreturn [msg_enable, msg_disable];","outputs":2,"noerr":0,"x":1050,"y":140,"wires":[["9f2873e5.e9c42","349f2f4d.693348"],["e8677cf7.b60778","b64f6abf.6d8918"]],"outputLabels":["enable","disable"]},{"id":"9f2873e5.e9c42","type":"ui_slider","z":"1c4a0adf.6f1c6d","name":"Threshold delta","label":"Threshold delta ({{ value }})","group":"577102d8.1f508c","order":2,"width":0,"height":0,"passthru":true,"topic":"","min":"1","max":"100","step":"1","x":1340,"y":220,"wires":[["dc9fe730.188aa8"]]},{"id":"7343e284.711654","type":"rbe","z":"1c4a0adf.6f1c6d","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1050,"y":220,"wires":[["9f2873e5.e9c42"]]},{"id":"88c3cc6.b34d73","type":"rbe","z":"1c4a0adf.6f1c6d","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1050,"y":280,"wires":[["349f2f4d.693348"]]},{"id":"349f2f4d.693348","type":"ui_slider","z":"1c4a0adf.6f1c6d","name":"Threshold Line Value","label":"Threshold Line Value ({{ value }})","group":"577102d8.1f508c","order":3,"width":0,"height":0,"passthru":true,"topic":"","min":"0","max":"255","step":"1","x":1360,"y":280,"wires":[["1bdf01a4.f93b2e"]]},{"id":"dc9fe730.188aa8","type":"mqtt out","z":"1c4a0adf.6f1c6d","name":"","topic":"config/threshold/delta","qos":"0","retain":"","broker":"e4efdb3b.bee6e","x":1600,"y":220,"wires":[]},{"id":"1bdf01a4.f93b2e","type":"mqtt out","z":"1c4a0adf.6f1c6d","name":"","topic":"config/threshold/default","qos":"0","retain":"","broker":"e4efdb3b.bee6e","x":1610,"y":280,"wires":[]},{"id":"26bc10d7.eb045","type":"mqtt out","z":"1c4a0adf.6f1c6d","name":"","topic":"config/threshold/dynamic_enabled","qos":"0","retain":"","broker":"e4efdb3b.bee6e","x":1600,"y":80,"wires":[]},{"id":"e5d88da.4634f7","type":"ui_button","z":"1c4a0adf.6f1c6d","name":"","group":"136a4024.3f49f","order":0,"width":"6","height":"2","passthru":false,"label":"Stop","color":"","bgcolor":"red","icon":"","payload":"","payloadType":"str","topic":"","x":1090,"y":660,"wires":[["c4125fbf.fe765"]]},{"id":"edd580f3.e19eb","type":"function","z":"1c4a0adf.6f1c6d","name":"enable","func":"msg.enabled = true;\n\nreturn msg;","outputs":1,"noerr":0,"x":1330,"y":600,"wires":[["e5d88da.4634f7","83d512a5.a5f95"]]},{"id":"19a1e338.b27525","type":"function","z":"1c4a0adf.6f1c6d","name":"disable","func":"msg.enabled = false;\n\nreturn msg;","outputs":1,"noerr":0,"x":1220,"y":720,"wires":[["e5d88da.4634f7"]]},{"id":"83d512a5.a5f95","type":"function","z":"1c4a0adf.6f1c6d","name":"disable","func":"msg.enabled = false;\n\nreturn msg;","outputs":1,"noerr":0,"x":1240,"y":560,"wires":[["2a5fdd74.f93502"]]},{"id":"c4125fbf.fe765","type":"function","z":"1c4a0adf.6f1c6d","name":"enable","func":"msg.enabled = true;\n\nreturn msg;","outputs":1,"noerr":0,"x":1330,"y":660,"wires":[["2a5fdd74.f93502","19a1e338.b27525"]]}]