[{"id":"1c4a0adf.6f1c6d","type":"tab","label":"Mqtt","disabled":false,"info":""},{"id":"318e3463.53696c","type":"tab","label":"Video","disabled":false,"info":""},{"id":"ebd531d9.758928","type":"tab","label":"Throttle","disabled":false,"info":""},{"id":"3f82d2eb.45cfde","type":"tab","label":"Threshold","disabled":false,"info":""},{"id":"e4951353.f79f88","type":"tab","label":"Angle","disabled":false,"info":""},{"id":"7c2be773.565628","type":"tab","label":"Config","disabled":false,"info":""},{"id":"2e9a47b6.15bac","type":"tab","label":"Save","disabled":false,"info":""},{"id":"e4efdb3b.bee6e","type":"mqtt-broker","z":"","name":"diabolo","broker":"192.168.1.204","port":"1883","clientid":"nodered-dashboard-","usetls":false,"compatmode":false,"keepalive":"60","cleansession":false,"willTopic":"","willQos":"0","willPayload":"","birthTopic":"","birthQos":"0","birthPayload":""},{"id":"5a7b8465.37fcbc","type":"ui_tab","z":"1c4a0adf.6f1c6d","name":"Home","icon":"home","order":1},{"id":"136a4024.3f49f","type":"ui_group","z":"1c4a0adf.6f1c6d","name":"Metrics","tab":"5a7b8465.37fcbc","order":2,"disp":true,"width":"12","collapse":false},{"id":"e986a62c.1e0a88","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","reset":false},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}}},"site":{"name":"Fous du volant board","hideToolbar":"false","allowSwipe":"true","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"c8f53699.bbd128","type":"ui_group","z":"","name":"Vision","tab":"5a7b8465.37fcbc","order":1,"disp":true,"width":"20","collapse":false},{"id":"f0a34f2f.71734","type":"mqtt-broker","z":"","name":"local","broker":"mqtt","port":"1883","clientid":"nodered-","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willPayload":"","birthTopic":"","birthQos":"0","birthPayload":""},{"id":"5cbd4649.35c31","type":"mqtt-broker","z":"","name":"satanas","broker":"satanas.local","port":"1883","clientid":"nodered-","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willPayload":"","birthTopic":"","birthQos":"0","birthPayload":""},{"id":"577102d8.1f508c","type":"ui_group","z":"","name":"Threshold","tab":"133766a1.36fce9","order":3,"disp":true,"width":"10","collapse":false},{"id":"36a57def.9cc8ea","type":"ui_group","z":"","name":"Commands","tab":"5a7b8465.37fcbc","order":3,"disp":true,"width":"6","collapse":false},{"id":"f13e3432.2fd838","type":"ui_group","z":"","name":"Throttle","tab":"4ade9889.40f6","order":2,"disp":true,"width":"20","collapse":false},{"id":"ea987d4e.ecb7d8","type":"ui_tab","z":"","name":"Config","icon":"dashboard","order":5},{"id":"8a925ff1.0199f8","type":"ui_group","z":"","name":"Load","tab":"ea987d4e.ecb7d8","order":1,"disp":true,"width":"6","collapse":false},{"id":"2c48ffdf.bb5248","type":"ui_group","z":"","name":"Save","tab":"ea987d4e.ecb7d8","order":2,"disp":true,"width":"6","collapse":false},{"id":"4ade9889.40f6","type":"ui_tab","z":"","name":"Throttle","icon":"dashboard","order":3},{"id":"937f4f0d.72cca","type":"ui_group","z":"","name":"Vision","tab":"4ade9889.40f6","order":1,"disp":true,"width":"20","collapse":false},{"id":"c1ffaaaf.7ea33","type":"ui_group","z":"","name":"Metrics","tab":"4ade9889.40f6","order":3,"disp":true,"width":"6","collapse":false},{"id":"133766a1.36fce9","type":"ui_tab","z":"","name":"Threshold","icon":"dashboard","order":2},{"id":"3c7293c2.80a654","type":"ui_group","z":"","name":"Vision","tab":"133766a1.36fce9","order":1,"disp":true,"width":"20","collapse":false},{"id":"7a684cec.4d7894","type":"ui_group","z":"","name":"Metrics","tab":"133766a1.36fce9","order":2,"disp":true,"width":"6","collapse":false},{"id":"77e10868.8a224","type":"ui_tab","z":"","name":"Angle","icon":"dashboard","order":4},{"id":"b7858dc.c44487","type":"ui_group","z":"","name":"Vision","tab":"77e10868.8a224","order":1,"disp":true,"width":"20","collapse":false},{"id":"7b8fa400.b534a4","type":"ui_group","z":"","name":"Angle","tab":"77e10868.8a224","order":2,"disp":true,"width":"20","collapse":false},{"id":"53417a9d.7bed04","type":"ui_group","z":"","name":"Metrics","tab":"77e10868.8a224","order":3,"disp":true,"width":"6","collapse":false},{"id":"6112acb7.e5507c","type":"ui_group","z":"","name":"Contours","tab":"133766a1.36fce9","order":4,"disp":true,"width":"10","collapse":false},{"id":"f24d64c6.6d0b7","type":"mqtt in","z":"1c4a0adf.6f1c6d","name":"","topic":"fousduvolant/+/parts","qos":"0","broker":"f0a34f2f.71734","x":130,"y":320,"wires":[["3a663e19.3a6d1a","68304281.cef6f4"]]},{"id":"3a663e19.3a6d1a","type":"json","z":"1c4a0adf.6f1c6d","name":"","property":"payload","action":"","pretty":false,"x":310,"y":320,"wires":[["24aff43f.f36d9c"]]},{"id":"24aff43f.f36d9c","type":"function","z":"1c4a0adf.6f1c6d","name":"extract data","func":"var parts = msg.payload.payload;\nmsg.payload = parts;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":320,"wires":[["6092201.7da46e","6b1249fe.e4dcb","16d9bcb5.acb273","24f18ef3.e6375a","b128678f.4faab","141e3af3.66c545"]]},{"id":"177d96f7.09c639","type":"ui_gauge","z":"1c4a0adf.6f1c6d","name":"","group":"136a4024.3f49f","order":1,"width":"6","height":"6","gtype":"gage","title":"Throttle","label":"units","format":"{{ value | number:2 }}","min":"0","max":"1","colors":["#00b500","#e6e600","#ca3838"],"seg1":"0,4","seg2":"0,8","x":1260,"y":220,"wires":[]},{"id":"28ad500c.2db76","type":"mqtt out","z":"1c4a0adf.6f1c6d","name":"local","topic":"","qos":"0","retain":"true","broker":"f0a34f2f.71734","x":310,"y":160,"wires":[]},{"id":"e010a1c.f2ce86","type":"mqtt in","z":"1c4a0adf.6f1c6d","name":"","topic":"fousduvolant/#","qos":"0","broker":"e4efdb3b.bee6e","x":120,"y":160,"wires":[["28ad500c.2db76","8269327.c1290d"]]},{"id":"d6560013.65a8c8","type":"comment","z":"1c4a0adf.6f1c6d","name":"Fetch message to local server","info":"","x":170,"y":60,"wires":[]},{"id":"8269327.c1290d","type":"debug","z":"1c4a0adf.6f1c6d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":290,"y":100,"wires":[]},{"id":"95dbd87.e3a4c28","type":"http in","z":"318e3463.53696c","name":"","url":"/video_camera","method":"get","upload":false,"swaggerDoc":"","x":630,"y":140,"wires":[["eed54432.c06578"]]},{"id":"2a4ccdd3.c8adb2","type":"comment","z":"318e3463.53696c","name":"camera","info":"","x":70,"y":140,"wires":[]},{"id":"eed54432.c06578","type":"multipart-encoder","z":"318e3463.53696c","name":"","statusCode":"","ignoreMessages":true,"outputOneNew":false,"outputIfSingle":true,"outputIfAll":true,"globalHeaders":{"Content-Type":"multipart/x-mixed-replace;boundary=--myboundary","Connection":"keep-alive","Expires":"Fri, 01 Jan 1990 00:00:00 GMT","Cache-Control":"no-cache, no-store, max-age=0, must-revalidate","Pragma":"no-cache"},"partHeaders":{"Content-Type":"image/jpeg"},"destination":"all","highWaterMark":16384,"x":1020,"y":140,"wires":[["673c0a28.a8dcfc"]]},{"id":"6e401af1.ad1a44","type":"function","z":"318e3463.53696c","name":"format msg","func":"var newMsg = {};\nnewMsg.payload = Buffer.from(msg.payload, 'base64')\nreturn newMsg;","outputs":1,"noerr":0,"x":830,"y":200,"wires":[["eed54432.c06578"]]},{"id":"41a77af8.dcbf44","type":"http in","z":"318e3463.53696c","name":"","url":"/video_contours","method":"get","upload":false,"swaggerDoc":"","x":640,"y":300,"wires":[["b71b5c62.a01e68"]]},{"id":"23c2e31c.b05e6c","type":"comment","z":"318e3463.53696c","name":"contours","info":"","x":80,"y":300,"wires":[]},{"id":"673c0a28.a8dcfc","type":"debug","z":"318e3463.53696c","name":"Encoder output","active":false,"console":"false","complete":"res","x":1240,"y":360,"wires":[]},{"id":"b71b5c62.a01e68","type":"multipart-encoder","z":"318e3463.53696c","name":"","statusCode":"","ignoreMessages":true,"outputOneNew":false,"outputIfSingle":true,"outputIfAll":true,"globalHeaders":{"Content-Type":"multipart/x-mixed-replace;boundary=--myboundary","Connection":"keep-alive","Expires":"Fri, 01 Jan 1990 00:00:00 GMT","Cache-Control":"no-cache, no-store, max-age=0, must-revalidate","Pragma":"no-cache"},"partHeaders":{"Content-Type":"image/jpeg"},"destination":"all","highWaterMark":16384,"x":1020,"y":300,"wires":[["673c0a28.a8dcfc"]]},{"id":"c223a078.dae848","type":"function","z":"318e3463.53696c","name":"format msg","func":"var newMsg = {};\nnewMsg.payload = Buffer.from(msg.payload, 'base64')\nreturn newMsg;","outputs":1,"noerr":0,"x":830,"y":360,"wires":[["b71b5c62.a01e68"]]},{"id":"a5504881.c442d8","type":"comment","z":"318e3463.53696c","name":"Stream to all clients","info":"","x":150,"y":40,"wires":[]},{"id":"6092201.7da46e","type":"function","z":"1c4a0adf.6f1c6d","name":"pilot/throttle","func":"msg.payload = msg.payload['pilot/throttle'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":220,"wires":[["b9843f1e.e75b28"]]},{"id":"41d5f97e.dd6b5","type":"ui_gauge","z":"1c4a0adf.6f1c6d","name":"","group":"136a4024.3f49f","order":2,"width":"6","height":"6","gtype":"gage","title":"Steering","label":"units","format":"{{ value | number:2 }}","min":"-1","max":"1","colors":["#00b500","#00b500","#00b500"],"seg1":"","seg2":"","x":1260,"y":280,"wires":[]},{"id":"6b1249fe.e4dcb","type":"function","z":"1c4a0adf.6f1c6d","name":"pilot/angle","func":"msg.payload = msg.payload['pilot/angle'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":280,"wires":[["3b3cd114.6b2dce"]]},{"id":"a5f9804e.70b25","type":"http in","z":"318e3463.53696c","name":"","url":"/video_processed","method":"get","upload":false,"swaggerDoc":"","x":640,"y":440,"wires":[["97071807.0acc3"]]},{"id":"158c8a24.90f366","type":"comment","z":"318e3463.53696c","name":"contours","info":"","x":80,"y":440,"wires":[]},{"id":"97071807.0acc3","type":"multipart-encoder","z":"318e3463.53696c","name":"","statusCode":"","ignoreMessages":true,"outputOneNew":false,"outputIfSingle":true,"outputIfAll":true,"globalHeaders":{"Content-Type":"multipart/x-mixed-replace;boundary=--myboundary","Connection":"keep-alive","Expires":"Fri, 01 Jan 1990 00:00:00 GMT","Cache-Control":"no-cache, no-store, max-age=0, must-revalidate","Pragma":"no-cache"},"partHeaders":{"Content-Type":"image/jpeg"},"destination":"all","highWaterMark":16384,"x":1020,"y":440,"wires":[["673c0a28.a8dcfc"]]},{"id":"a46213d.034ba7","type":"function","z":"318e3463.53696c","name":"format msg","func":"var newMsg = {};\nnewMsg.payload = Buffer.from(msg.payload, 'base64')\nreturn newMsg;","outputs":1,"noerr":0,"x":830,"y":500,"wires":[["97071807.0acc3"]]},{"id":"b7834c20.bd1918","type":"json","z":"318e3463.53696c","name":"","property":"payload","action":"","pretty":false,"x":430,"y":200,"wires":[["35260bb9.3206f4"]]},{"id":"35260bb9.3206f4","type":"function","z":"318e3463.53696c","name":"extract image","func":"var image = msg.payload.payload;\nmsg.payload = image;\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":200,"wires":[["6e401af1.ad1a44"]]},{"id":"8e805af6.2f9968","type":"mqtt in","z":"318e3463.53696c","name":"","topic":"fousduvolant/+/image/cam/image_array","qos":"0","broker":"f0a34f2f.71734","x":180,"y":200,"wires":[["b7834c20.bd1918"]]},{"id":"312f2021.3b569","type":"ui_template","z":"318e3463.53696c","group":"c8f53699.bbd128","name":"Image camera","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_camera\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":240,"y":140,"wires":[[]]},{"id":"29f8a202.23620e","type":"ui_template","z":"318e3463.53696c","group":"c8f53699.bbd128","name":"Image processed","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_processed\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":250,"y":440,"wires":[[]]},{"id":"1637f06a.3517d8","type":"mqtt in","z":"318e3463.53696c","name":"","topic":"fousduvolant/+/image/img/processed","qos":"0","broker":"f0a34f2f.71734","x":170,"y":500,"wires":[["ec2c02ba.fb5a8"]]},{"id":"ec2c02ba.fb5a8","type":"json","z":"318e3463.53696c","name":"","property":"payload","action":"","pretty":false,"x":430,"y":500,"wires":[["89711665.93862"]]},{"id":"89711665.93862","type":"function","z":"318e3463.53696c","name":"extract image","func":"var image = msg.payload.payload;\nmsg.payload = image;\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":500,"wires":[["a46213d.034ba7"]]},{"id":"1cdc2bf2.d276dc","type":"ui_template","z":"318e3463.53696c","group":"c8f53699.bbd128","name":"Image contours","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_contours\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":240,"y":300,"wires":[[]]},{"id":"d0b27a81.1dfe9","type":"mqtt in","z":"318e3463.53696c","name":"","topic":"fousduvolant/+/image/img/angle_contours","qos":"0","broker":"f0a34f2f.71734","x":180,"y":360,"wires":[["9a2fa2e9.7af458"]]},{"id":"9a2fa2e9.7af458","type":"json","z":"318e3463.53696c","name":"","property":"payload","action":"","pretty":false,"x":430,"y":360,"wires":[["b9c7190.a7b1ee8"]]},{"id":"b9c7190.a7b1ee8","type":"function","z":"318e3463.53696c","name":"extract image","func":"var image = msg.payload.payload;\nmsg.payload = image;\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":360,"wires":[["c223a078.dae848"]]},{"id":"b9843f1e.e75b28","type":"rbe","z":"1c4a0adf.6f1c6d","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1030,"y":220,"wires":[["177d96f7.09c639"]]},{"id":"3b3cd114.6b2dce","type":"rbe","z":"1c4a0adf.6f1c6d","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1030,"y":280,"wires":[["41d5f97e.dd6b5"]]},{"id":"16d9bcb5.acb273","type":"link out","z":"1c4a0adf.6f1c6d","name":"part","links":["19fb800e.69ede","9565ee76.51ed5","e1dc942a.01a2e8","3d143291.131cce"],"x":635,"y":440,"wires":[]},{"id":"96198618.720fc","type":"ui_slider","z":"ebd531d9.758928","name":"Throttle Min","label":"Min  ({{  value | number:2 }})","group":"f13e3432.2fd838","order":2,"width":0,"height":0,"passthru":true,"topic":"","min":"0","max":"1","step":"0.01","x":910,"y":440,"wires":[["a0c1b478.83e808"]]},{"id":"61238bd5.355f1c","type":"ui_slider","z":"ebd531d9.758928","name":"Throttle Max","label":"Max  ({{  value | number:2 }})","group":"f13e3432.2fd838","order":3,"width":0,"height":0,"passthru":true,"topic":"","min":"0","max":"1","step":"0.01","x":910,"y":500,"wires":[["41237e4b.1d15e"]]},{"id":"d71904bc.349c78","type":"ui_slider","z":"ebd531d9.758928","name":"Throttle Safe Angle","label":"Safe Angle  ({{  value | number:2 }})","group":"f13e3432.2fd838","order":4,"width":0,"height":0,"passthru":true,"topic":"","min":"0","max":"1","step":"0.01","x":930,"y":380,"wires":[["c83731c2.21a"]]},{"id":"781c20c1.5d8aa8","type":"ui_slider","z":"ebd531d9.758928","name":"Throttle Dangerous Angle","label":"Dangerous Angle  ({{  value | number:2 }})","group":"f13e3432.2fd838","order":5,"width":0,"height":0,"passthru":true,"topic":"","min":"0","max":"1","step":"0.01","x":950,"y":320,"wires":[["e41c0cf1.0f924"]]},{"id":"4176b00d.f8c7c","type":"ui_switch","z":"ebd531d9.758928","name":"Throttle Compute from steering","label":"Compute from steering","group":"f13e3432.2fd838","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":970,"y":160,"wires":[["3d709d6e.699502","e08117ad.aacb6"]]},{"id":"63d66ba0.743ef4","type":"function","z":"ebd531d9.758928","name":"enable when On","func":"var msg_enable = {};\nmsg_enable.topic= msg.topic;\nvar msg_disable = {};\nmsg_disable.topic= msg.topic;\n\nif (msg.payload) {\n    msg_enable.enabled = true;\n    msg_disable.enabled = false;\n}else {\n    msg_enable.enabled = false;\n    msg_disable.enabled = true;\n}\n\nreturn [msg_enable, msg_disable];","outputs":2,"noerr":0,"x":770,"y":260,"wires":[["d71904bc.349c78","781c20c1.5d8aa8"],[]],"outputLabels":["enable","disable"]},{"id":"19fb800e.69ede","type":"link in","z":"ebd531d9.758928","name":"throttle part","links":["16d9bcb5.acb273"],"x":75,"y":400,"wires":[["c91237c2.4a38b","c9c1f8a3.d8a06","e5c288bf.92dbd8","d029b04c.da511","2736d9b6.9d6d8e","57001988.9eccf8","749a7a99.2e6c74","e46c85ed.026a2"]]},{"id":"e5c288bf.92dbd8","type":"function","z":"ebd531d9.758928","name":"cfg/throttle/min","func":"msg.payload = msg.payload['cfg/throttle/min'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":440,"wires":[["f23b1167.7b876"]]},{"id":"d029b04c.da511","type":"function","z":"ebd531d9.758928","name":"cfg/throttle/max","func":"msg.payload = msg.payload['cfg/throttle/max'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":500,"wires":[["5abfa8fc.0b6b78"]]},{"id":"c91237c2.4a38b","type":"function","z":"ebd531d9.758928","name":"cfg/throttle/angle/dangerous","func":"msg.payload = msg.payload['cfg/throttle/angle/dangerous'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":320,"wires":[["a448cdbd.f34c5"]]},{"id":"c9c1f8a3.d8a06","type":"function","z":"ebd531d9.758928","name":"cfg/throttle/angle/safe","func":"msg.payload = msg.payload['cfg/throttle/angle/safe'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":380,"wires":[["43e9b17d.87eec8"]]},{"id":"a0c1b478.83e808","type":"mqtt out","z":"ebd531d9.758928","name":"","topic":"config/throttle/min","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1270,"y":440,"wires":[]},{"id":"41237e4b.1d15e","type":"mqtt out","z":"ebd531d9.758928","name":"","topic":"config/throttle/max","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1270,"y":500,"wires":[]},{"id":"e41c0cf1.0f924","type":"mqtt out","z":"ebd531d9.758928","name":"","topic":"config/throttle/angle/dangerous","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1310,"y":320,"wires":[]},{"id":"c83731c2.21a","type":"mqtt out","z":"ebd531d9.758928","name":"","topic":"config/throttle/angle/safe","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1290,"y":380,"wires":[]},{"id":"5abfa8fc.0b6b78","type":"rbe","z":"ebd531d9.758928","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":590,"y":500,"wires":[["61238bd5.355f1c"]]},{"id":"f23b1167.7b876","type":"rbe","z":"ebd531d9.758928","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":590,"y":440,"wires":[["96198618.720fc"]]},{"id":"43e9b17d.87eec8","type":"rbe","z":"ebd531d9.758928","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":590,"y":380,"wires":[["d71904bc.349c78"]]},{"id":"a448cdbd.f34c5","type":"rbe","z":"ebd531d9.758928","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":590,"y":320,"wires":[["781c20c1.5d8aa8"]]},{"id":"201c05b4.5f945a","type":"ui_switch","z":"ebd531d9.758928","name":"Throttle Stop on shock","label":"Stop on shock","group":"f13e3432.2fd838","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":940,"y":560,"wires":[["5dda3c44.00f29c"]]},{"id":"5dda3c44.00f29c","type":"mqtt out","z":"ebd531d9.758928","name":"","topic":"config/throttle/stop_on_shock","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1310,"y":560,"wires":[]},{"id":"2736d9b6.9d6d8e","type":"function","z":"ebd531d9.758928","name":"cfg/throttle/stop_on_shock","func":"msg.payload = msg.payload['cfg/throttle/stop_on_shock'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":560,"wires":[["e5525d95.61a7e8"]]},{"id":"e5525d95.61a7e8","type":"rbe","z":"ebd531d9.758928","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":590,"y":560,"wires":[["201c05b4.5f945a"]]},{"id":"f1ae38f6.d96098","type":"comment","z":"ebd531d9.758928","name":"Throttle","info":"","x":140,"y":60,"wires":[]},{"id":"57001988.9eccf8","type":"function","z":"ebd531d9.758928","name":"cfg/throttle/compute_from_steering","func":"msg.payload = msg.payload['cfg/throttle/compute_from_steering'];\n\nif(msg.payload === null){\n    msg.payload = false;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":160,"wires":[["d92f0a4d.6263a8"]]},{"id":"d92f0a4d.6263a8","type":"rbe","z":"ebd531d9.758928","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":590,"y":160,"wires":[["4176b00d.f8c7c"]]},{"id":"3d709d6e.699502","type":"rbe","z":"ebd531d9.758928","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":590,"y":260,"wires":[["63d66ba0.743ef4"]]},{"id":"e08117ad.aacb6","type":"mqtt out","z":"ebd531d9.758928","name":"","topic":"config/throttle/compute_from_steering","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1330,"y":160,"wires":[]},{"id":"cd09ce60.9982d","type":"function","z":"3f82d2eb.45cfde","name":"cfg/threshold/from_line","func":"msg.payload = msg.payload['cfg/threshold/from_line'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":160,"wires":[[]]},{"id":"c39969f6.d43968","type":"function","z":"3f82d2eb.45cfde","name":"cfg/threshold/dynamic/delta","func":"msg.payload = msg.payload['cfg/threshold/dynamic/delta'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":220,"wires":[["59270ce6.3271dc"]]},{"id":"45648441.fdd074","type":"ui_slider","z":"3f82d2eb.45cfde","name":"Threshold min","label":"Threshold min ({{ value }})","group":"577102d8.1f508c","order":4,"width":0,"height":0,"passthru":true,"topic":"","min":0,"max":"255","step":"1","x":960,"y":340,"wires":[["e3d4c834.5b0668"]]},{"id":"8b165713.c3c28","type":"function","z":"3f82d2eb.45cfde","name":"cfg/threshold/limit/min","func":"msg.payload = msg.payload['cfg/threshold/limit/min'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":340,"wires":[["57278bd7.40eb54"]]},{"id":"e51484bb.d43c68","type":"ui_slider","z":"3f82d2eb.45cfde","name":"Threshold max","label":"Threshold max ({{ value }})","group":"577102d8.1f508c","order":5,"width":0,"height":0,"passthru":true,"topic":"","min":0,"max":"255","step":1,"x":960,"y":400,"wires":[["51fb1af2.61a484"]]},{"id":"a23955a4.27adc8","type":"function","z":"3f82d2eb.45cfde","name":"cfg/threshold/limit/max","func":"msg.payload = msg.payload['cfg/threshold/limit/max'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":400,"wires":[["6312f567.c07f6c"]]},{"id":"57278bd7.40eb54","type":"rbe","z":"3f82d2eb.45cfde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":670,"y":340,"wires":[["45648441.fdd074"]]},{"id":"6312f567.c07f6c","type":"rbe","z":"3f82d2eb.45cfde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":670,"y":400,"wires":[["e51484bb.d43c68"]]},{"id":"e3d4c834.5b0668","type":"mqtt out","z":"3f82d2eb.45cfde","name":"","topic":"config/threshold/min","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1220,"y":340,"wires":[]},{"id":"51fb1af2.61a484","type":"mqtt out","z":"3f82d2eb.45cfde","name":"","topic":"config/threshold/max","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1220,"y":400,"wires":[]},{"id":"da98dc43.e7eb","type":"ui_switch","z":"3f82d2eb.45cfde","name":"","label":"Dynamic Threshold","group":"577102d8.1f508c","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":710,"y":80,"wires":[["1f4beb3.be19695","c4509fc2.db3358"]]},{"id":"1f4beb3.be19695","type":"function","z":"3f82d2eb.45cfde","name":"enable when On","func":"var msg_enable = {};\nmsg_enable.topic= msg.topic;\nvar msg_disable = {};\nmsg_disable.topic= msg.topic;\n\nif (msg.payload) {\n    msg_enable.enabled = true;\n    msg_disable.enabled = false;\n}else {\n    msg_enable.enabled = false;\n    msg_disable.enabled = true;\n}\n\nreturn [msg_enable, msg_disable];","outputs":2,"noerr":0,"x":790,"y":140,"wires":[["3f04646.6752a9c","f45e7e2b.b02ec8"],["45648441.fdd074","e51484bb.d43c68"]],"outputLabels":["enable","disable"]},{"id":"3f04646.6752a9c","type":"ui_slider","z":"3f82d2eb.45cfde","name":"Threshold delta","label":"Threshold delta ({{ value }})","group":"577102d8.1f508c","order":2,"width":0,"height":0,"passthru":true,"topic":"","min":"1","max":"100","step":"1","x":960,"y":220,"wires":[["f8d86a7.d3b1618"]]},{"id":"59270ce6.3271dc","type":"rbe","z":"3f82d2eb.45cfde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":670,"y":220,"wires":[["3f04646.6752a9c"]]},{"id":"e9f40e14.98cc78","type":"rbe","z":"3f82d2eb.45cfde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":670,"y":280,"wires":[["f45e7e2b.b02ec8"]]},{"id":"f45e7e2b.b02ec8","type":"ui_slider","z":"3f82d2eb.45cfde","name":"Threshold Line Value","label":"Centroid value ({{ value }})","group":"577102d8.1f508c","order":3,"width":0,"height":0,"passthru":false,"topic":"","min":"0","max":"255","step":"1","x":980,"y":280,"wires":[["276011eb.da5d66"]]},{"id":"f8d86a7.d3b1618","type":"mqtt out","z":"3f82d2eb.45cfde","name":"","topic":"config/threshold/delta","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1220,"y":220,"wires":[]},{"id":"276011eb.da5d66","type":"mqtt out","z":"3f82d2eb.45cfde","name":"","topic":"config/threshold/from_line","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1240,"y":280,"wires":[]},{"id":"c4509fc2.db3358","type":"mqtt out","z":"3f82d2eb.45cfde","name":"","topic":"config/threshold/dynamic_enabled","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1220,"y":80,"wires":[]},{"id":"9565ee76.51ed5","type":"link in","z":"3f82d2eb.45cfde","name":"Threhold part","links":["16d9bcb5.acb273"],"x":75,"y":520,"wires":[["c39969f6.d43968","cd09ce60.9982d","8b165713.c3c28","a23955a4.27adc8","295e24f1.26f85c","1b89f4c7.f5f573","9a812472.1d86a8","87cf9979.4abb1","8d6932f.8212f5","72a3f29f.7f0f64","7e827244.b4e514","ec5d9590.7874e"]]},{"id":"b766e59a.f0e26","type":"mqtt out","z":"1c4a0adf.6f1c6d","name":"car","topic":"","qos":"0","retain":"true","broker":"e4efdb3b.bee6e","x":730,"y":100,"wires":[]},{"id":"2095260f.5b649a","type":"mqtt in","z":"1c4a0adf.6f1c6d","name":"","topic":"config/#","qos":"0","broker":"f0a34f2f.71734","x":510,"y":100,"wires":[["b766e59a.f0e26"]]},{"id":"558aa033.a3fa18","type":"ui_dropdown","z":"7c2be773.565628","name":"","label":"Config","place":"Select config","group":"8a925ff1.0199f8","order":0,"width":0,"height":0,"passthru":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":730,"y":180,"wires":[["1ca4eaa1.7b554d","fcb850e6.382228"]]},{"id":"26c479eb.cad196","type":"file","z":"7c2be773.565628","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":650,"y":620,"wires":[]},{"id":"dc10253b.c4b2d8","type":"ui_form","z":"7c2be773.565628","name":"Save form","label":"Save","group":"2c48ffdf.bb5248","order":0,"width":0,"height":0,"options":[{"label":"File name","value":"file_name","type":"text","required":true}],"formValue":{"file_name":""},"payload":"","topic":"","x":190,"y":620,"wires":[["a6de73d0.668c68"]]},{"id":"3d143291.131cce","type":"link in","z":"7c2be773.565628","name":"","links":["16d9bcb5.acb273"],"x":135,"y":540,"wires":[["7bcb5eec.5aea2"]]},{"id":"f9892fbb.d0894","type":"function","z":"7c2be773.565628","name":"Save last part in context","func":"flow.set('last_part', msg.payload)\nreturn msg;","outputs":0,"noerr":0,"x":510,"y":540,"wires":[]},{"id":"a6de73d0.668c68","type":"function","z":"7c2be773.565628","name":"Read last part in context","func":"var filename = msg.payload.file_name;\n\nmsg.payload = flow.get('last_part');\nmsg.filename = filename;\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":620,"wires":[["26c479eb.cad196"]]},{"id":"2cb61f97.ecce98","type":"ui_button","z":"1c4a0adf.6f1c6d","name":"","group":"136a4024.3f49f","order":4,"width":"6","height":"2","passthru":false,"label":"Autopilot","color":"","bgcolor":"green","icon":"","payload":"local","payloadType":"str","topic":"","x":1260,"y":360,"wires":[["ee118b00.327798"]]},{"id":"747bbebb.aa77d8","type":"ui_button","z":"1c4a0adf.6f1c6d","name":"","group":"136a4024.3f49f","order":5,"width":"6","height":"2","passthru":false,"label":"Stop","color":"","bgcolor":"red","icon":"","payload":"user","payloadType":"str","topic":"","x":1250,"y":420,"wires":[["ee118b00.327798"]]},{"id":"24f18ef3.e6375a","type":"function","z":"1c4a0adf.6f1c6d","name":"user/mode","func":"msg.payload = msg.payload['user/mode'];\n\nmsg_user = null;\nmsg_autopilot = null;\n\nif(msg.payload === 'user'){\n    msg_user = msg;\n}else{\n    msg_autopilot = msg;\n}\n\nreturn [msg_autopilot, msg_user];","outputs":2,"noerr":0,"x":690,"y":380,"wires":[["20071e41.5657c2","619500b1.a39b6"],["15c2ebf3.f1fbac","e9211e8c.affb4"]],"outputLabels":["autopilot","user"]},{"id":"aafab0ce.251bf","type":"rbe","z":"1c4a0adf.6f1c6d","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"enabled","x":1070,"y":360,"wires":[["2cb61f97.ecce98","6589b197.d7b4f"]]},{"id":"1f507d6.8abe283","type":"rbe","z":"1c4a0adf.6f1c6d","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"enabled","x":1070,"y":420,"wires":[["747bbebb.aa77d8","e818a7a9.8fe568"]]},{"id":"ee118b00.327798","type":"mqtt out","z":"1c4a0adf.6f1c6d","name":"","topic":"config/drive/mode","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1490,"y":380,"wires":[]},{"id":"20071e41.5657c2","type":"function","z":"1c4a0adf.6f1c6d","name":"enable","func":"msg.enabled = true;\n\nreturn msg;","outputs":1,"noerr":0,"x":890,"y":320,"wires":[["1f507d6.8abe283"]]},{"id":"619500b1.a39b6","type":"function","z":"1c4a0adf.6f1c6d","name":"disable","func":"msg.enabled = false;\n\nreturn msg;","outputs":1,"noerr":0,"x":900,"y":360,"wires":[["aafab0ce.251bf"]]},{"id":"e9211e8c.affb4","type":"function","z":"1c4a0adf.6f1c6d","name":"enable","func":"msg.enabled = true;\n\nreturn msg;","outputs":1,"noerr":0,"x":890,"y":460,"wires":[["aafab0ce.251bf"]]},{"id":"15c2ebf3.f1fbac","type":"function","z":"1c4a0adf.6f1c6d","name":"disable","func":"msg.enabled = false;\n\nreturn msg;","outputs":1,"noerr":0,"x":900,"y":420,"wires":[["1f507d6.8abe283"]]},{"id":"d30112c3.e416b8","type":"fs-file-lister","z":"7c2be773.565628","name":"List /data/config","start":"/data/config/","pattern":"*.json","path":true,"single":true,"depth":0,"stat":false,"x":320,"y":180,"wires":[["62d0e143.2e1168"]]},{"id":"8962286d.c6813","type":"watch","z":"7c2be773.565628","name":"","files":"/data/config/","recursive":"","x":130,"y":220,"wires":[["d30112c3.e416b8"]]},{"id":"cfcc318b.9db788","type":"inject","z":"7c2be773.565628","name":"Started!","topic":"","payload":"{\"start\":\"/data/config/\",\"pattern\":\"*.json\"}","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":"0.1","x":140,"y":140,"wires":[["d30112c3.e416b8","d3c321da.bd9478"]]},{"id":"62d0e143.2e1168","type":"function","z":"7c2be773.565628","name":"Set options","func":"msg.options = msg.payload;\nmsg.payload = {};\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":180,"wires":[["558aa033.a3fa18"]]},{"id":"9866d683.9f1288","type":"ui_template","z":"ebd531d9.758928","group":"937f4f0d.72cca","name":"Image camera","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_camera\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":320,"y":60,"wires":[[]]},{"id":"ac69e21b.23dce","type":"ui_template","z":"ebd531d9.758928","group":"937f4f0d.72cca","name":"Image processed","order":2,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_processed\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":550,"y":60,"wires":[[]]},{"id":"7e276925.c64c18","type":"ui_gauge","z":"ebd531d9.758928","name":"","group":"c1ffaaaf.7ea33","order":1,"width":0,"height":0,"gtype":"gage","title":"Throttle","label":"units","format":"{{ value | number:2 }}","min":"0","max":"1","colors":["#00b500","#e6e600","#ca3838"],"seg1":"0,4","seg2":"0,8","x":860,"y":660,"wires":[]},{"id":"749a7a99.2e6c74","type":"function","z":"ebd531d9.758928","name":"pilot/throttle","func":"msg.payload = msg.payload['pilot/throttle'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":660,"wires":[["9931b400.f5285"]]},{"id":"8c856a85.d3b81","type":"ui_gauge","z":"ebd531d9.758928","name":"","group":"c1ffaaaf.7ea33","order":2,"width":0,"height":0,"gtype":"gage","title":"Steering","label":"units","format":"{{ value | number:2 }}","min":"-1","max":"1","colors":["#00b500","#00b500","#00b500"],"seg1":"","seg2":"","x":860,"y":720,"wires":[]},{"id":"e46c85ed.026a2","type":"function","z":"ebd531d9.758928","name":"pilot/angle","func":"msg.payload = msg.payload['pilot/angle'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":720,"wires":[["c2673e1d.a50b7"]]},{"id":"9931b400.f5285","type":"rbe","z":"ebd531d9.758928","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":630,"y":660,"wires":[["7e276925.c64c18"]]},{"id":"c2673e1d.a50b7","type":"rbe","z":"ebd531d9.758928","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":630,"y":720,"wires":[["8c856a85.d3b81"]]},{"id":"477596f1.073058","type":"ui_template","z":"ebd531d9.758928","group":"937f4f0d.72cca","name":"Image contours","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_contours\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":780,"y":60,"wires":[[]]},{"id":"88e9125.1ec4f7","type":"ui_button","z":"ebd531d9.758928","name":"","group":"c1ffaaaf.7ea33","order":4,"width":"6","height":"2","passthru":false,"label":"Stop","color":"","bgcolor":"red","icon":"","payload":"user","payloadType":"str","topic":"","x":270,"y":780,"wires":[["65732a5f.a7c994"]]},{"id":"65732a5f.a7c994","type":"mqtt out","z":"ebd531d9.758928","name":"","topic":"config/drive/mode","qos":"0","retain":"","broker":"f0a34f2f.71734","x":670,"y":800,"wires":[]},{"id":"b2a9b839.5c9688","type":"ui_template","z":"3f82d2eb.45cfde","group":"3c7293c2.80a654","name":"Image camera","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_camera\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":320,"y":40,"wires":[[]]},{"id":"c19507dd.fb88","type":"ui_template","z":"3f82d2eb.45cfde","group":"3c7293c2.80a654","name":"Image contours","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_contours\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":780,"y":40,"wires":[[]]},{"id":"cc4c1365.81eff8","type":"ui_gauge","z":"3f82d2eb.45cfde","name":"","group":"7a684cec.4d7894","order":1,"width":0,"height":0,"gtype":"gage","title":"Throttle","label":"units","format":"{{ value | number:2 }}","min":"0","max":"1","colors":["#00b500","#e6e600","#ca3838"],"seg1":"0,4","seg2":"0,8","x":900,"y":520,"wires":[]},{"id":"295e24f1.26f85c","type":"function","z":"3f82d2eb.45cfde","name":"pilot/throttle","func":"msg.payload = msg.payload['pilot/throttle'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":520,"wires":[["de377164.8b03d8"]]},{"id":"eb84575f.3d49b","type":"ui_gauge","z":"3f82d2eb.45cfde","name":"","group":"7a684cec.4d7894","order":2,"width":0,"height":0,"gtype":"gage","title":"Steering","label":"units","format":"{{ value | number:2 }}","min":"-1","max":"1","colors":["#00b500","#00b500","#00b500"],"seg1":"","seg2":"","x":900,"y":580,"wires":[]},{"id":"1b89f4c7.f5f573","type":"function","z":"3f82d2eb.45cfde","name":"pilot/angle","func":"msg.payload = msg.payload['pilot/angle'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":580,"wires":[["1f145593.89a5b2"]]},{"id":"de377164.8b03d8","type":"rbe","z":"3f82d2eb.45cfde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":670,"y":520,"wires":[["cc4c1365.81eff8"]]},{"id":"1f145593.89a5b2","type":"rbe","z":"3f82d2eb.45cfde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":670,"y":580,"wires":[["eb84575f.3d49b"]]},{"id":"8cd50068.6be84","type":"ui_button","z":"3f82d2eb.45cfde","name":"","group":"7a684cec.4d7894","order":4,"width":"6","height":"2","passthru":false,"label":"Stop","color":"","bgcolor":"red","icon":"","payload":"user","payloadType":"str","topic":"","x":310,"y":880,"wires":[["92b3d5ae.747ec"]]},{"id":"92b3d5ae.747ec","type":"mqtt out","z":"3f82d2eb.45cfde","name":"","topic":"config/drive/mode","qos":"0","retain":"","broker":"f0a34f2f.71734","x":710,"y":900,"wires":[]},{"id":"e1dbc4a8.ded39","type":"link in","z":"3f82d2eb.45cfde","name":"Threshold stop","links":["e818a7a9.8fe568"],"x":75,"y":880,"wires":[["8cd50068.6be84"]]},{"id":"536af4d7.4dfc34","type":"link in","z":"ebd531d9.758928","name":"throttle stop","links":["e818a7a9.8fe568"],"x":75,"y":780,"wires":[["88e9125.1ec4f7"]]},{"id":"e818a7a9.8fe568","type":"link out","z":"1c4a0adf.6f1c6d","name":"Display Stop boutton","links":["536af4d7.4dfc34","e1dbc4a8.ded39","a9973389.529a88"],"x":1215,"y":460,"wires":[]},{"id":"ffbfd2b7.a12ca","type":"ui_slider","z":"e4951353.f79f88","name":"Out zone","label":"Out zone ({{  value }})","group":"7b8fa400.b534a4","order":2,"width":0,"height":0,"passthru":true,"topic":"","min":"0","max":"100","step":"1","x":880,"y":260,"wires":[["eb3bb1eb.32257"]]},{"id":"6960d10d.3e2cf8","type":"ui_slider","z":"e4951353.f79f88","name":"Central zone","label":"Central zone ({{  value }})","group":"7b8fa400.b534a4","order":3,"width":0,"height":0,"passthru":true,"topic":"","min":"0","max":"100","step":"1","x":890,"y":320,"wires":[["7472999c.ecef08"]]},{"id":"e1dc942a.01a2e8","type":"link in","z":"e4951353.f79f88","name":"throttle part","links":["16d9bcb5.acb273"],"x":55,"y":220,"wires":[["8d9de3fb.7e5978","c1676a3e.889c98","67dc7120.97e848","efd2990b.937308","43833099.7d29e"]]},{"id":"8d9de3fb.7e5978","type":"function","z":"e4951353.f79f88","name":"cfg/angle/out_zone_percent","func":"msg.payload = msg.payload['angle/out_zone_percent'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":260,"wires":[["2de47be9.aea8ec"]]},{"id":"c1676a3e.889c98","type":"function","z":"e4951353.f79f88","name":"cfg/angle/central_zone_percent","func":"msg.payload = msg.payload['cfg/angle/central_zone_percent'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":320,"wires":[["3cb33fe4.02f758"]]},{"id":"eb3bb1eb.32257","type":"mqtt out","z":"e4951353.f79f88","name":"","topic":"config/angle/out_zone_percent","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1290,"y":260,"wires":[]},{"id":"7472999c.ecef08","type":"mqtt out","z":"e4951353.f79f88","name":"","topic":"config/angle/central_zone_percent","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1300,"y":320,"wires":[]},{"id":"3cb33fe4.02f758","type":"rbe","z":"e4951353.f79f88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":570,"y":320,"wires":[["6960d10d.3e2cf8"]]},{"id":"2de47be9.aea8ec","type":"rbe","z":"e4951353.f79f88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":570,"y":260,"wires":[["ffbfd2b7.a12ca"]]},{"id":"c2f3bc8d.c861c8","type":"mqtt out","z":"e4951353.f79f88","name":"","topic":"config/angle/number_centroids_to_use","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1320,"y":380,"wires":[]},{"id":"67dc7120.97e848","type":"function","z":"e4951353.f79f88","name":"cfg/angle/number_centroids_to_use","func":"msg.payload = msg.payload['cfg/angle/number_centroids_to_use'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":380,"wires":[["ef195090.c4e59"]]},{"id":"ef195090.c4e59","type":"rbe","z":"e4951353.f79f88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":570,"y":380,"wires":[["d04de64e.76742"]]},{"id":"173e409f.a7886f","type":"ui_gauge","z":"e4951353.f79f88","name":"","group":"53417a9d.7bed04","order":1,"width":0,"height":0,"gtype":"gage","title":"Throttle","label":"units","format":"{{ value | number:2 }}","min":"0","max":"1","colors":["#00b500","#e6e600","#ca3838"],"seg1":"0,4","seg2":"0,8","x":840,"y":480,"wires":[]},{"id":"efd2990b.937308","type":"function","z":"e4951353.f79f88","name":"pilot/throttle","func":"msg.payload = msg.payload['pilot/throttle'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":480,"wires":[["1c1bfc67.591a3c"]]},{"id":"aae82aff.dcd7d8","type":"ui_gauge","z":"e4951353.f79f88","name":"","group":"53417a9d.7bed04","order":2,"width":0,"height":0,"gtype":"gage","title":"Steering","label":"units","format":"{{ value | number:2 }}","min":"-1","max":"1","colors":["#00b500","#00b500","#00b500"],"seg1":"","seg2":"","x":840,"y":540,"wires":[]},{"id":"43833099.7d29e","type":"function","z":"e4951353.f79f88","name":"pilot/angle","func":"msg.payload = msg.payload['pilot/angle'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":540,"wires":[["aa8ebcf2.c4872"]]},{"id":"1c1bfc67.591a3c","type":"rbe","z":"e4951353.f79f88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":610,"y":480,"wires":[["173e409f.a7886f"]]},{"id":"aa8ebcf2.c4872","type":"rbe","z":"e4951353.f79f88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":610,"y":540,"wires":[["aae82aff.dcd7d8"]]},{"id":"a9da5b08.731948","type":"ui_button","z":"e4951353.f79f88","name":"","group":"53417a9d.7bed04","order":4,"width":"6","height":"2","passthru":false,"label":"Stop","color":"","bgcolor":"red","icon":"","payload":"user","payloadType":"str","topic":"","x":250,"y":600,"wires":[["d74ddd5c.f8f0d8"]]},{"id":"d74ddd5c.f8f0d8","type":"mqtt out","z":"e4951353.f79f88","name":"","topic":"config/drive/mode","qos":"0","retain":"","broker":"f0a34f2f.71734","x":650,"y":640,"wires":[]},{"id":"a9973389.529a88","type":"link in","z":"e4951353.f79f88","name":"throttle stop","links":["e818a7a9.8fe568"],"x":55,"y":600,"wires":[["a9da5b08.731948"]]},{"id":"f024b840.b0e588","type":"ui_template","z":"e4951353.f79f88","group":"b7858dc.c44487","name":"Image camera","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_camera\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":160,"y":60,"wires":[[]]},{"id":"8748231d.5dd808","type":"ui_template","z":"e4951353.f79f88","group":"b7858dc.c44487","name":"Image contours","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_contours\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":380,"y":60,"wires":[[]]},{"id":"ff8eb18.5c10d5","type":"http in","z":"318e3463.53696c","name":"","url":"/video_angle","method":"get","upload":false,"swaggerDoc":"","x":630,"y":580,"wires":[["14a6b646.8df952"]]},{"id":"9b554e9b.441818","type":"comment","z":"318e3463.53696c","name":"contours","info":"","x":80,"y":580,"wires":[]},{"id":"14a6b646.8df952","type":"multipart-encoder","z":"318e3463.53696c","name":"","statusCode":"","ignoreMessages":true,"outputOneNew":false,"outputIfSingle":true,"outputIfAll":true,"globalHeaders":{"Content-Type":"multipart/x-mixed-replace;boundary=--myboundary","Connection":"keep-alive","Expires":"Fri, 01 Jan 1990 00:00:00 GMT","Cache-Control":"no-cache, no-store, max-age=0, must-revalidate","Pragma":"no-cache"},"partHeaders":{"Content-Type":"image/jpeg"},"destination":"all","highWaterMark":16384,"x":1020,"y":580,"wires":[["673c0a28.a8dcfc"]]},{"id":"4a868ad0.78e934","type":"function","z":"318e3463.53696c","name":"format msg","func":"var newMsg = {};\nnewMsg.payload = Buffer.from(msg.payload, 'base64')\nreturn newMsg;","outputs":1,"noerr":0,"x":830,"y":640,"wires":[["14a6b646.8df952"]]},{"id":"16a55497.297813","type":"ui_template","z":"318e3463.53696c","group":"c8f53699.bbd128","name":"Image Angle","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_angle\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":230,"y":580,"wires":[[]]},{"id":"31775e78.b3ed52","type":"mqtt in","z":"318e3463.53696c","name":"","topic":"fousduvolant/+/image/img/angle_zone","qos":"0","broker":"f0a34f2f.71734","x":170,"y":640,"wires":[["674337c7.c07a5"]]},{"id":"674337c7.c07a5","type":"json","z":"318e3463.53696c","name":"","property":"payload","action":"","pretty":false,"x":430,"y":640,"wires":[["7802affb.541738"]]},{"id":"7802affb.541738","type":"function","z":"318e3463.53696c","name":"extract image","func":"var image = msg.payload.payload;\nmsg.payload = image;\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":640,"wires":[["4a868ad0.78e934"]]},{"id":"c190d2d2.f96c48","type":"ui_template","z":"e4951353.f79f88","group":"b7858dc.c44487","name":"Image Angle","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_angle\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":610,"y":60,"wires":[[]]},{"id":"6589b197.d7b4f","type":"link out","z":"1c4a0adf.6f1c6d","name":"Display Autopilot boutton","links":["62748d52.3942e4","63f6164e.47f79","a1c6fe73.56f468"],"x":1215,"y":320,"wires":[]},{"id":"dc780d3c.69003","type":"ui_button","z":"ebd531d9.758928","name":"","group":"c1ffaaaf.7ea33","order":3,"width":"6","height":"2","passthru":false,"label":"Autopilot","color":"","bgcolor":"green","icon":"","payload":"local","payloadType":"str","topic":"","x":280,"y":840,"wires":[["65732a5f.a7c994"]]},{"id":"62748d52.3942e4","type":"link in","z":"ebd531d9.758928","name":"throttle autopilot","links":["6589b197.d7b4f"],"x":75,"y":840,"wires":[["dc780d3c.69003"]]},{"id":"63f6164e.47f79","type":"link in","z":"3f82d2eb.45cfde","name":"Threshold autopilot","links":["6589b197.d7b4f"],"x":75,"y":940,"wires":[["ffd6b694.6d73f"]]},{"id":"ffd6b694.6d73f","type":"ui_button","z":"3f82d2eb.45cfde","name":"","group":"7a684cec.4d7894","order":3,"width":"6","height":"2","passthru":false,"label":"Autopilot","color":"","bgcolor":"green","icon":"","payload":"local","payloadType":"str","topic":"","x":320,"y":940,"wires":[["92b3d5ae.747ec"]]},{"id":"a1c6fe73.56f468","type":"link in","z":"e4951353.f79f88","name":"Angle autopilot","links":["6589b197.d7b4f"],"x":55,"y":680,"wires":[["ebda739.97a819"]]},{"id":"ebda739.97a819","type":"ui_button","z":"e4951353.f79f88","name":"","group":"53417a9d.7bed04","order":3,"width":"6","height":"2","passthru":false,"label":"Autopilot","color":"","bgcolor":"green","icon":"","payload":"local","payloadType":"str","topic":"","x":260,"y":680,"wires":[["d74ddd5c.f8f0d8"]]},{"id":"7bcb5eec.5aea2","type":"json","z":"7c2be773.565628","name":"","property":"payload","action":"","pretty":false,"x":270,"y":540,"wires":[["f9892fbb.d0894"]]},{"id":"b1a09f7e.0601f","type":"file in","z":"7c2be773.565628","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"x":690,"y":320,"wires":[["55520201.2c8c44"]]},{"id":"25ae9a52.032d9e","type":"function","z":"7c2be773.565628","name":"Get filename in context","func":"msg.payload = flow.get('config_filename');\nif(msg.payload === null || msg.payload === '{}' || msg.payload == {}) {\n    return null;    \n}\nmsg.filename = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":320,"wires":[["b1a09f7e.0601f"]]},{"id":"55520201.2c8c44","type":"json","z":"7c2be773.565628","name":"","property":"payload","action":"","pretty":false,"x":840,"y":320,"wires":[["a8795c41.f36"]]},{"id":"a8795c41.f36","type":"function","z":"7c2be773.565628","name":"Reformat msg","func":"var payload = msg.payload;\nmsg.payload = {};\nmsg.payload.payload = payload;\nreturn msg;","outputs":1,"noerr":0,"x":1040,"y":320,"wires":[["2d4355c1.c7a942","d3c321da.bd9478"]]},{"id":"28ea32aa.319c36","type":"link in","z":"1c4a0adf.6f1c6d","name":"Inject config","links":["2d4355c1.c7a942"],"x":300,"y":380,"wires":[["24aff43f.f36d9c"]]},{"id":"2d4355c1.c7a942","type":"link out","z":"7c2be773.565628","name":"Inject config","links":["28ea32aa.319c36"],"x":1230,"y":320,"wires":[]},{"id":"9a812472.1d86a8","type":"function","z":"3f82d2eb.45cfde","name":"cfg/contours/poly_dp_min","func":"msg.payload = msg.payload['cfg/contours/poly_dp_min'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":640,"wires":[["2561fb9.c61e984"]]},{"id":"e73abd9a.af74e8","type":"ui_slider","z":"3f82d2eb.45cfde","name":"poly_dp_min","label":"poly_dp_min ({{ value }})","group":"6112acb7.e5507c","order":2,"width":0,"height":0,"passthru":true,"topic":"","min":"0","max":"20","step":"1","x":950,"y":640,"wires":[["e6064c0e.d36e88"]]},{"id":"2561fb9.c61e984","type":"rbe","z":"3f82d2eb.45cfde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":670,"y":640,"wires":[["e73abd9a.af74e8"]]},{"id":"e6064c0e.d36e88","type":"mqtt out","z":"3f82d2eb.45cfde","name":"","topic":"config/contours/poly_dp_min","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1240,"y":640,"wires":[]},{"id":"87cf9979.4abb1","type":"function","z":"3f82d2eb.45cfde","name":"cfg/contours/poly_dp_max","func":"msg.payload = msg.payload['cfg/contours/poly_dp_max'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":700,"wires":[["918e4f01.38bbb8"]]},{"id":"58584829.19dcb","type":"ui_slider","z":"3f82d2eb.45cfde","name":"poly_dp_max","label":"poly_dp_max ({{ value }})","group":"6112acb7.e5507c","order":2,"width":0,"height":0,"passthru":true,"topic":"","min":"0","max":"20","step":"1","x":960,"y":700,"wires":[["5fe267d8.724ce"]]},{"id":"918e4f01.38bbb8","type":"rbe","z":"3f82d2eb.45cfde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":670,"y":700,"wires":[["58584829.19dcb"]]},{"id":"5fe267d8.724ce","type":"mqtt out","z":"3f82d2eb.45cfde","name":"","topic":"config/contours/poly_dp_max","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1250,"y":700,"wires":[]},{"id":"8d6932f.8212f5","type":"function","z":"3f82d2eb.45cfde","name":"cfg/contours/arc_length_min","func":"msg.payload = msg.payload['cfg/contours/arc_length_min'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":760,"wires":[["4aa843ff.f3db94"]]},{"id":"c6a565a2.173418","type":"ui_slider","z":"3f82d2eb.45cfde","name":"arc_length_min","label":"arc_length_min ({{ value }})","group":"6112acb7.e5507c","order":2,"width":0,"height":0,"passthru":true,"topic":"","min":"0","max":"100","step":"1","x":960,"y":760,"wires":[["52c874d3.a2e544"]]},{"id":"4aa843ff.f3db94","type":"rbe","z":"3f82d2eb.45cfde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":670,"y":760,"wires":[["c6a565a2.173418"]]},{"id":"52c874d3.a2e544","type":"mqtt out","z":"3f82d2eb.45cfde","name":"","topic":"config/contours/arc_length_min","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1250,"y":760,"wires":[]},{"id":"72a3f29f.7f0f64","type":"function","z":"3f82d2eb.45cfde","name":"cfg/contours/arc_length_max","func":"msg.payload = msg.payload['cfg/contours/arc_length_max'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":820,"wires":[["25802825.3e0f4"]]},{"id":"a7ab7770.2c0de","type":"ui_slider","z":"3f82d2eb.45cfde","name":"arc_length_max","label":"arc_length_max ({{ value }})","group":"6112acb7.e5507c","order":2,"width":0,"height":0,"passthru":true,"topic":"","min":"0","max":"200","step":"1","x":960,"y":820,"wires":[["c3b521b7.9c44e"]]},{"id":"25802825.3e0f4","type":"rbe","z":"3f82d2eb.45cfde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":670,"y":820,"wires":[["a7ab7770.2c0de"]]},{"id":"c3b521b7.9c44e","type":"mqtt out","z":"3f82d2eb.45cfde","name":"","topic":"config/contours/arc_length_max","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1250,"y":820,"wires":[]},{"id":"7e827244.b4e514","type":"function","z":"3f82d2eb.45cfde","name":"cfg/threshold/dynamic_enabled","func":"msg.payload = msg.payload['cfg/threshold/dynamic/delta'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":80,"wires":[["2d22dffd.7aa388"]]},{"id":"2d22dffd.7aa388","type":"rbe","z":"3f82d2eb.45cfde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":530,"y":80,"wires":[["da98dc43.e7eb"]]},{"id":"1f3816a7.7b66d9","type":"ui_button","z":"7c2be773.565628","name":"","group":"8a925ff1.0199f8","order":0,"width":0,"height":0,"passthru":false,"label":"Load","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":390,"y":320,"wires":[["25ae9a52.032d9e"]]},{"id":"1ca4eaa1.7b554d","type":"function","z":"7c2be773.565628","name":"Save filename in context","func":"flow.set('config_filename', msg.payload)\nreturn msg;","outputs":0,"noerr":0,"x":1010,"y":180,"wires":[]},{"id":"fcb850e6.382228","type":"function","z":"7c2be773.565628","name":"enable","func":"msg.enabled = true;\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":380,"wires":[["1f3816a7.7b66d9"]],"outputLabels":["enable","disable"]},{"id":"d3c321da.bd9478","type":"function","z":"7c2be773.565628","name":"disable","func":"msg.enabled = false;\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":260,"wires":[["1f3816a7.7b66d9"]],"outputLabels":["enable"]},{"id":"8981973c.b677b8","type":"function","z":"1c4a0adf.6f1c6d","name":"Car name","func":"var car = msg.topic.split('/')[1];\ncontext.global.set(\"car_name\", car);","outputs":0,"noerr":0,"x":460,"y":460,"wires":[]},{"id":"68304281.cef6f4","type":"rbe","z":"1c4a0adf.6f1c6d","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"topic","x":290,"y":460,"wires":[["8981973c.b677b8"]]},{"id":"f73ba208.2400b8","type":"function","z":"3f82d2eb.45cfde","name":"cfg/threshold/from_line","func":"msg.payload = msg.payload['cfg/threshold_value_estimator/centroid_value'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":280,"wires":[["e9f40e14.98cc78"]]},{"id":"a8977839.9bfae8","type":"mqtt in","z":"2e9a47b6.15bac","name":"","topic":"fousduvolant/+/image/img/contours","qos":"0","broker":"f0a34f2f.71734","x":200,"y":260,"wires":[["25c0b563.cde92a"]]},{"id":"b4d47054.63e5f8","type":"mqtt in","z":"2e9a47b6.15bac","name":"","topic":"fousduvolant/+/image/cam/image_array","qos":"0","broker":"f0a34f2f.71734","x":180,"y":200,"wires":[["25c0b563.cde92a"]]},{"id":"b7d1d5c7.1dfcc8","type":"mqtt in","z":"2e9a47b6.15bac","name":"","topic":"fousduvolant/+/parts","qos":"0","broker":"f0a34f2f.71734","x":250,"y":320,"wires":[["25c0b563.cde92a"]]},{"id":"25c0b563.cde92a","type":"json","z":"2e9a47b6.15bac","name":"","property":"payload","action":"","pretty":false,"x":450,"y":260,"wires":[["2981a221.763b0e","36f56138.e02d46"]]},{"id":"e09e4888.54e2a","type":"function","z":"2e9a47b6.15bac","name":"Dir save","func":"var path = \"/records/\" + context.global.get(\"car_name\") + '/';\nvar app_headers =msg.payload.application_headers;\n\nvar partDir = \"json\";\nif(app_headers.part !== null) {\n    partDir = app_headers.part;\n}\npath = path + app_headers.tub_name + '/' + partDir + '/';\npath = path + app_headers.name;\n\nmsg.filename = path;\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":160,"wires":[["39c3f224.85850e"]]},{"id":"ae2f7392.87331","type":"file","z":"2e9a47b6.15bac","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":1290,"y":260,"wires":[]},{"id":"669fe2d2.4e4794","type":"json","z":"2e9a47b6.15bac","name":"","property":"payload","action":"","pretty":true,"x":1110,"y":300,"wires":[["ae2f7392.87331"]]},{"id":"a8d027d1.f143f","type":"switch","z":"2e9a47b6.15bac","name":"","property":"content_type","propertyType":"msg","rules":[{"t":"eq","v":"image/jpeg","vt":"str"},{"t":"eq","v":"application/json","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":950,"y":260,"wires":[["6b31058a.6a92f4"],["669fe2d2.4e4794"]],"outputLabels":["image/jpeg","application/json"]},{"id":"39c3f224.85850e","type":"change","z":"2e9a47b6.15bac","name":"Format message","rules":[{"t":"move","p":"payload.content_type","pt":"msg","to":"content_type","tot":"msg"},{"t":"move","p":"payload.payload","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":160,"wires":[["a8d027d1.f143f"]]},{"id":"6b31058a.6a92f4","type":"function","z":"2e9a47b6.15bac","name":"format msg","func":"msg.payload = Buffer.from(msg.payload, 'base64')\nreturn msg;","outputs":1,"noerr":0,"x":1110,"y":220,"wires":[["ae2f7392.87331"]]},{"id":"36f56138.e02d46","type":"switch","z":"2e9a47b6.15bac","name":"Record on autopilot","property":"usermode","propertyType":"flow","rules":[{"t":"neq","v":"user","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":660,"y":260,"wires":[["e09e4888.54e2a"]]},{"id":"fec07a5f.14df3","type":"change","z":"2e9a47b6.15bac","name":"Set flow.usermode","rules":[{"t":"set","p":"usermode","pt":"flow","to":"payload.payload.user/mode","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1170,"y":460,"wires":[[]]},{"id":"2981a221.763b0e","type":"switch","z":"2e9a47b6.15bac","name":"only json parts","property":"payload.content_type","propertyType":"msg","rules":[{"t":"eq","v":"application/json","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":670,"y":460,"wires":[["a29d0afb.9c7a1"]]},{"id":"a29d0afb.9c7a1","type":"rbe","z":"2e9a47b6.15bac","name":"When user/mode changes","func":"rbe","gap":"","start":"","inout":"out","property":"payload.payload.user/mode","x":920,"y":460,"wires":[["fec07a5f.14df3"]]},{"id":"9ba5337f.eb545","type":"comment","z":"2e9a47b6.15bac","name":"User/mode context","info":"","x":680,"y":420,"wires":[]},{"id":"d04de64e.76742","type":"ui_slider","z":"e4951353.f79f88","name":"Nb centroids to use","label":"Nb centroids to use ({{  value }})","group":"7b8fa400.b534a4","order":3,"width":0,"height":0,"passthru":false,"topic":"","min":"1","max":"20","step":"1","x":910,"y":380,"wires":[["c2f3bc8d.c861c8"]]},{"id":"41901870.88c4d8","type":"ui_template","z":"3f82d2eb.45cfde","group":"3c7293c2.80a654","name":"Image horizon","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_horizon\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1000,"y":40,"wires":[[]]},{"id":"a81ab956.56794","type":"http in","z":"318e3463.53696c","name":"","url":"/video_horizon","method":"get","upload":false,"swaggerDoc":"","x":630,"y":720,"wires":[["8ef58549.832598"]]},{"id":"1bc7841f.812bdc","type":"comment","z":"318e3463.53696c","name":"horizon","info":"","x":70,"y":720,"wires":[]},{"id":"8ef58549.832598","type":"multipart-encoder","z":"318e3463.53696c","name":"","statusCode":"","ignoreMessages":true,"outputOneNew":false,"outputIfSingle":true,"outputIfAll":true,"globalHeaders":{"Content-Type":"multipart/x-mixed-replace;boundary=--myboundary","Connection":"keep-alive","Expires":"Fri, 01 Jan 1990 00:00:00 GMT","Cache-Control":"no-cache, no-store, max-age=0, must-revalidate","Pragma":"no-cache"},"partHeaders":{"Content-Type":"image/jpeg"},"destination":"all","highWaterMark":16384,"x":1020,"y":720,"wires":[[]]},{"id":"436e8cba.e5008c","type":"function","z":"318e3463.53696c","name":"format msg","func":"var newMsg = {};\nnewMsg.payload = Buffer.from(msg.payload, 'base64')\nreturn newMsg;","outputs":1,"noerr":0,"x":830,"y":780,"wires":[["8ef58549.832598"]]},{"id":"87e4f593.24c138","type":"ui_template","z":"318e3463.53696c","group":"c8f53699.bbd128","name":"Image horizon","order":1,"width":"6","height":"6","format":"<img width=\"16\" height=\"16\" src=\"../video_horizon\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":240,"y":720,"wires":[[]]},{"id":"e69e5901.20a238","type":"mqtt in","z":"318e3463.53696c","name":"","topic":"fousduvolant/+/image/img/horizon","qos":"0","broker":"f0a34f2f.71734","x":160,"y":780,"wires":[["a6268ac1.a9bb7"]]},{"id":"a6268ac1.a9bb7","type":"json","z":"318e3463.53696c","name":"","property":"payload","action":"","pretty":false,"x":430,"y":780,"wires":[["3fb948f8.67ada"]]},{"id":"3fb948f8.67ada","type":"function","z":"318e3463.53696c","name":"extract image","func":"var image = msg.payload.payload;\nmsg.payload = image;\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":780,"wires":[["436e8cba.e5008c"]]},{"id":"f820d0dc.cffb58","type":"ui_slider","z":"3f82d2eb.45cfde","name":"Horizon","label":"Horizon({{ value   }})","group":"577102d8.1f508c","order":6,"width":0,"height":0,"passthru":true,"topic":"","min":0,"max":"1","step":"0.05","x":940,"y":460,"wires":[["591bb1f7.a3cd2"]]},{"id":"ec5d9590.7874e","type":"function","z":"3f82d2eb.45cfde","name":"cfg/threshold/horizon","func":"msg.payload = msg.payload['cfg/threshold/horizon'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":460,"wires":[["6d7cdebe.933f38"]]},{"id":"6d7cdebe.933f38","type":"rbe","z":"3f82d2eb.45cfde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":670,"y":460,"wires":[["f820d0dc.cffb58"]]},{"id":"591bb1f7.a3cd2","type":"mqtt out","z":"3f82d2eb.45cfde","name":"","topic":"config/threshold/horizon","qos":"0","retain":"","broker":"f0a34f2f.71734","x":1230,"y":460,"wires":[]},{"id":"b128678f.4faab","type":"function","z":"1c4a0adf.6f1c6d","name":"sleep_time","func":"rate = msg.payload['rate_htz'];\nsleep_time = msg.payload['sleep_time'];\nmax_sleep = 1.0 / rate;\nsleep_percent = sleep_time / max_sleep * 100;\n\nif(msg.payload === null){\n    msg.payload = 100;\n} else {\n    msg.payload =  100 - sleep_percent;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":540,"wires":[["b5b234b6.3c5d7","3e6616e9.25387a"]]},{"id":"b5b234b6.3c5d7","type":"debug","z":"1c4a0adf.6f1c6d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":880,"y":540,"wires":[]},{"id":"141e3af3.66c545","type":"function","z":"1c4a0adf.6f1c6d","name":"rate","func":"msg.payload = msg.payload['rate_htz'];\n\nif(msg.payload === null){\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":580,"wires":[["b5b234b6.3c5d7"]]},{"id":"3e6616e9.25387a","type":"ui_gauge","z":"1c4a0adf.6f1c6d","name":"","group":"136a4024.3f49f","order":3,"width":"6","height":"6","gtype":"gage","title":"Sleep time","label":"units","format":"{{ value | number:0}}","min":"0","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"60","seg2":"90","x":1110,"y":560,"wires":[]}]